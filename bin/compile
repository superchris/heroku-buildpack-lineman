#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

#######################
## 1. Node.js Setup  ##
#######################

# fail fast
set -e

echo "---> Where am i?: `pwd`"
echo "---> which ruby"
echo "`which ruby`"
echo "`ruby -v`"
echo "`ls -la vendor`"
echo $PATH

source ~/.profile.d/ruby.sh

echo "ruby version: `ruby -v`"
# debug
# set -x

# clean up leaking environment
unset GIT_DIR

# config
SCONS_VERSION="1.2.0"
S3_BUCKET="heroku-buildpack-nodejs"

# parse and derive params
BUILD_DIR=$1
CACHE_DIR=$2
LP_DIR=`cd $(dirname $0); cd ..; pwd`

export PATH="$CACHE_DIR/vendor/bundle/bin:$CACHE_DIR/vendor/bundle/ruby-2.0.0/bin:$CACHE_DIR/vendor/ruby-2.0.0/bin:/app/bin:$PATH:$GEM_PATH/bin"

echo $CACHE_DIR
echo $PATH
echo "`ls -la $CACHE_DIR/vendor/bundle`"
chmod +x ~/.profile.d/ruby.sh
~/.profile.d/ruby.sh
echo "`ruby -v`"
